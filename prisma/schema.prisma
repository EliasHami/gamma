// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

model ProductCapacity {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    subFamily   ProductSubFamily @relation(fields: [subFamilyId], references: [id], onDelete: Cascade)
    subFamilyId String
    productNeeds ProductNeed[]
    @@index([subFamilyId])
}

model ProductSubFamily {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    capacities ProductCapacity[]
    family   ProductFamily @relation(fields: [familyId], references: [id], onDelete: Cascade)
    familyId String
    productNeeds ProductNeed[]
    @@index([familyId])
}

model ProductFamily {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    subFamilies ProductSubFamily[]
    productNeeds ProductNeed[]
}

enum DEPARTMENT {
    EQUIPEMENT
    DOMICILE
}

enum VALIDATION_STATE {
  VALIDATED
  NOT_VALIDATED
}

model ProductNeed {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    department DEPARTMENT
    family   ProductFamily @relation(fields: [familyId], references: [id])
    familyId String
    subFamily   ProductSubFamily @relation(fields: [subFamilyId], references: [id])
    subFamilyId String
    capacity   ProductCapacity @relation(fields: [capacityId], references: [id])
    capacityId String
    country  String
    targetPublicPrice Float
    state    VALIDATION_STATE
    offers   Offer[]
    additionalCost Float
    customsTax Float
    @@index(familyId)
    @@index(subFamilyId)
    @@index(capacityId)
}

enum YESNO {
    YES
    NO
}

enum SUPPLIER_STATUSES {
    EMAIL_SENT
    CATALOGUE_RECEIVED
    PRICE_LIST_RECEIVED
}

model Supplier {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    email     String
    phone     String
    country   String
    status    SUPPLIER_STATUSES
    offers   Offer[]
}

enum OFFER_STATUSES {
    OPEN
    CLOSED
    ACTIVE // on achet√© chez ce fournisseur
}

model Offer {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  need  ProductNeed @relation(fields: [needId], references: [id], onDelete: Restrict)
  needId  String
  supplier Supplier  @relation(fields: [supplierId], references: [id], onDelete: Restrict)
  supplierId String
  fobPrice  Float
  currency  String
  validation YESNO
  status  OFFER_STATUSES 
  image Json
  quantityPerContainer Int
  date DateTime
  @@index(needId)
  @@index(supplierId)
}

model Company {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String   @unique
  name      String
  address   String
  email     String
  phone     String
  currency  String
  insuranceRate Float
  bankChargeRate Float
  customsRate Float
  VATRate Float
  country   String
}

model Freight {
  id       String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String @unique
  country String
  price   Float
}