// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

model ProductCapacity {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    subFamily   ProductSubFamily @relation(fields: [subFamilyId], references: [id], onDelete: Cascade)
    subFamilyId String
    productNeeds ProductNeed[]
    @@index([subFamilyId])
}

model ProductSubFamily {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    capacities ProductCapacity[]
    family   ProductFamily @relation(fields: [familyId], references: [id], onDelete: Cascade)
    familyId String
    productNeeds ProductNeed[]
    @@index([familyId])
}

model ProductFamily {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    subFamilies ProductSubFamily[]
    productNeeds ProductNeed[]
}

enum DEPARTMENT {
    EQUIPEMENT
    DOMICILE
}

enum VALIDATION_STATE {
  VALIDATED
  NOT_VALIDATED
}

model ProductNeed {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    department DEPARTMENT
    family   ProductFamily @relation(fields: [familyId], references: [id])
    familyId String
    subFamily   ProductSubFamily @relation(fields: [subFamilyId], references: [id])
    subFamilyId String
    capacity   ProductCapacity @relation(fields: [capacityId], references: [id])
    capacityId String
    color     String?
    country  String
    targetPublicPrice Float
    state    VALIDATION_STATE
    results   ProductResult[]
    additionalCost Float
    customsTax Float
    @@index(familyId)
    @@index(subFamilyId)
    @@index(capacityId)
}

enum YESNO {
    YES
    NO
}

enum SUPPLIER_STATUSES {
    OPEN
    CLOSED
    PREFERRED
	@@map("STATUSES")
}

model Supplier {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    email     String
    phone     String
    country   String
    validation YESNO
    status    SUPPLIER_STATUSES
    results   ProductResult[]
}

enum CURRENCIES {
  USD
  EUR
  MAD
}

enum RESULT_STATUSES {
    OPEN
    CLOSED
    ACTIVE
    COMPETITOR
}

model ProductResult {
  id        String   @id @default(cuid())
  need  ProductNeed @relation(fields: [needId], references: [id], onDelete: Restrict)
  needId  String
  supplier Supplier  @relation(fields: [supplierId], references: [id], onDelete: Restrict)
  supplierId String
  fobPrice  Float
  currency  CURRENCIES
  validation YESNO
  status  RESULT_STATUSES 
  image Json
  quantityPerContainer Int
  DDPPrice Float @default(0)
  @@index(needId)
  @@index(supplierId)
}

model Company {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String   @unique
  name      String
  address   String
  email     String
  phone     String
  insuranceRate Float
  bankChargeRate Float
  customsRate Float
  VATRate Float
  country   String
}

model Freight {
  id       String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String
  country String
  price   Float
}